---
import { slugify, formatBlogPosts } from '../../js/utils';

import MainLayout from "../../layouts/MainLayout.astro";
import PostCard from "../../components/PostCard.astro";

export async function getStaticPaths() {
	const allPosts = await Astro.glob("../blog/*.md");
	const formattedPosts = formatBlogPosts(allPosts);

	const allCategories = [
		... new Set( formattedPosts.map((post) => post.frontmatter.category )
	)]

	return allCategories.map((category) => (
		{
			params: { category: slugify(category) },
			props: { name: category }
		}
	))
}

const { category } = Astro.params;
const { name } = Astro.props;

const allPosts = await Astro.glob("../blog/*.md");
const formattedPosts = formatBlogPosts(allPosts);
const postsOfCategory = formattedPosts.filter((post) => slugify(post.frontmatter.category) === category)
---

<MainLayout title={name}>
	<section class="container" aria-label={`Posts about ${name}`}>
		<h1 class="h1">Posts about <span>{name}</span></h1>
		<div class="post-container">
			{
				postsOfCategory.map((post) => (
					<PostCard frontmatter={post.frontmatter} url={post.url} />
				))
			}
		</div>
	</section>
</MainLayout>